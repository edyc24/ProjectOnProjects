PROIECT SBD - MONEYSHOP
Student: Cristea Eduard
Grupa: 505

REZOLVAREA CERINTEI 6: CREAREA TABELELOR SI POPULAREA LOR

PARTEA 1: CREAREA TABELELOR

SET SERVEROUTPUT ON;
ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS';
ALTER SESSION SET NLS_TIMESTAMP_FORMAT = 'YYYY-MM-DD HH24:MI:SS.FF';
CREATE TABLE ROLURI (
IdRol NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
NumeRol VARCHAR2(50) NOT NULL UNIQUE,
Descriere VARCHAR2(500),
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT chk_nume_rol CHECK (NumeRol IN ('CLIENT', 'BROKER', 'ADMIN'))
);
CREATE TABLE UTILIZATORI (
IdUtilizator NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
Nume VARCHAR2(100) NOT NULL,
Prenume VARCHAR2(100) NOT NULL,
Username VARCHAR2(50) NOT NULL UNIQUE,
Email VARCHAR2(255) NOT NULL UNIQUE,
Parola VARCHAR2(255) NOT NULL,
NumarTelefon VARCHAR2(20),
EmailVerified NUMBER(1) DEFAULT 0,
PhoneVerified NUMBER(1) DEFAULT 0,
DataNastere DATE NOT NULL,
IdRol NUMBER NOT NULL,
IsDeleted NUMBER(1) DEFAULT 0,
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
UpdatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT chk_email_verified CHECK (EmailVerified IN (0, 1)),
CONSTRAINT chk_phone_verified CHECK (PhoneVerified IN (0, 1)),
CONSTRAINT chk_is_deleted CHECK (IsDeleted IN (0, 1)),
CONSTRAINT fk_utilizatori_rol FOREIGN KEY (IdRol) REFERENCES ROLURI(IdRol),
CONSTRAINT chk_email_format CHECK (REGEXP_LIKE(Email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$')),
CONSTRAINT chk_telefon_format CHECK (NumarTelefon IS NULL OR REGEXP_LIKE(NumarTelefon, '^[0-9]{10}$'))
);
CREATE TABLE BANCI (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
Name VARCHAR2(200) NOT NULL UNIQUE,
CommissionPercent NUMBER(5,2) NOT NULL,
Active NUMBER(1) DEFAULT 1,
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT chk_commission CHECK (CommissionPercent BETWEEN 0 AND 100),
CONSTRAINT chk_bank_active CHECK (Active IN (0, 1))
);
CREATE TABLE APLICATII (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
UserId NUMBER NOT NULL,
Status VARCHAR2(50) DEFAULT 'INREGISTRAT' NOT NULL,
TypeCredit VARCHAR2(50),
TipOperatiune VARCHAR2(50),
SalariuNet NUMBER(18,2),
BonuriMasa NUMBER(1),
SumaBonuriMasa NUMBER(18,2),
VechimeLuni NUMBER,
NrCrediteBanci NUMBER,
ListaBanciActive CLOB,
NrIfn NUMBER,
Poprire NUMBER(1),
SoldTotal NUMBER(18,2),
Intarzieri NUMBER(1),
IntarzieriNumar NUMBER,
CardCredit CLOB,
Overdraft CLOB,
Codebitori CLOB,
Scoring NUMBER(5,2),
Dti NUMBER(5,2),
RecommendedLevel VARCHAR2(50),
SumaAprobata NUMBER(18,2),
Comision NUMBER(18,2),
DataDisbursare TIMESTAMP,
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
UpdatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_aplicatii_user FOREIGN KEY (UserId) REFERENCES UTILIZATORI(IdUtilizator),
CONSTRAINT chk_status CHECK (Status IN ('INREGISTRAT', 'IN_PROCESARE', 'APROBAT', 'REFUZAT', 'ANULAT')),
CONSTRAINT chk_type_credit CHECK (TypeCredit IS NULL OR TypeCredit IN ('IPOTECAR', 'NEVOI_PERSONALE', 'REFINANTARE')),
CONSTRAINT chk_tip_operatiune CHECK (TipOperatiune IS NULL OR TipOperatiune IN ('NOU', 'REFINANTARE')),
CONSTRAINT chk_scoring CHECK (Scoring IS NULL OR Scoring BETWEEN 300 AND 850),
CONSTRAINT chk_dti CHECK (Dti IS NULL OR Dti BETWEEN 0 AND 100),
CONSTRAINT chk_salariu CHECK (SalariuNet IS NULL OR SalariuNet >= 0),
CONSTRAINT chk_bonuri_masa CHECK (BonuriMasa IS NULL OR BonuriMasa IN (0, 1)),
CONSTRAINT chk_poprire CHECK (Poprire IS NULL OR Poprire IN (0, 1)),
CONSTRAINT chk_intarzieri CHECK (Intarzieri IS NULL OR Intarzieri IN (0, 1))
);
CREATE TABLE APPLICATION_BANKS (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
ApplicationId NUMBER NOT NULL,
BankId NUMBER NOT NULL,
Status VARCHAR2(50) DEFAULT 'PENDING',
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_app_banks_app FOREIGN KEY (ApplicationId) REFERENCES APLICATII(Id) ON DELETE CASCADE,
CONSTRAINT fk_app_banks_bank FOREIGN KEY (BankId) REFERENCES BANCI(Id),
CONSTRAINT uk_app_bank UNIQUE (ApplicationId, BankId),
CONSTRAINT chk_app_bank_status CHECK (Status IN ('PENDING', 'APPROVED', 'REJECTED', 'CANCELLED'))
);
CREATE TABLE DOCUMENTE (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
ApplicationId NUMBER NOT NULL,
TipDocument VARCHAR2(50) NOT NULL,
NumeFisier VARCHAR2(255) NOT NULL,
Path VARCHAR2(1000) NOT NULL,
SizeBytes NUMBER NOT NULL,
MimeType VARCHAR2(100),
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_documente_app FOREIGN KEY (ApplicationId) REFERENCES APLICATII(Id) ON DELETE CASCADE,
CONSTRAINT chk_tip_document CHECK (TipDocument IN ('CI', 'FLUTURAS', 'EXTRAS_CONT', 'CONTRACT', 'ALTUL')),
CONSTRAINT chk_size_bytes CHECK (SizeBytes > 0)
);
CREATE TABLE AGREEMENTS (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
ApplicationId NUMBER NOT NULL,
TipAcord VARCHAR2(50) NOT NULL,
Status VARCHAR2(50) DEFAULT 'ACTIV',
DataAcord TIMESTAMP DEFAULT SYSTIMESTAMP,
DataExpirare TIMESTAMP,
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_agreements_app FOREIGN KEY (ApplicationId) REFERENCES APLICATII(Id) ON DELETE CASCADE,
CONSTRAINT chk_tip_acord CHECK (TipAcord IN ('TERMENI_CONDITII', 'CONSENT_GDPR', 'MANDAT_BROKER')),
CONSTRAINT chk_agreement_status CHECK (Status IN ('ACTIV', 'EXPIRAT', 'REVOCAT')),
CONSTRAINT chk_data_expirare CHECK (DataExpirare IS NULL OR DataExpirare > DataAcord)
);
CREATE TABLE LEADURI (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
Nume VARCHAR2(100) NOT NULL,
Prenume VARCHAR2(100) NOT NULL,
Email VARCHAR2(255),
NumarTelefon VARCHAR2(20),
Status VARCHAR2(50) DEFAULT 'NOU',
Source VARCHAR2(100),
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT chk_lead_status CHECK (Status IN ('NOU', 'CONTACTAT', 'CONVERTIT', 'RESPINS')),
CONSTRAINT chk_lead_email CHECK (Email IS NULL OR REGEXP_LIKE(Email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$')),
CONSTRAINT chk_lead_telefon CHECK (NumarTelefon IS NULL OR REGEXP_LIKE(NumarTelefon, '^[0-9]{10}$'))
);
CREATE TABLE CONSENTURI (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
UserId NUMBER NOT NULL,
TipConsent VARCHAR2(50) NOT NULL,
Status VARCHAR2(50) DEFAULT 'ACTIV',
DataConsent TIMESTAMP DEFAULT SYSTIMESTAMP,
DataExpirare TIMESTAMP,
IpAddress VARCHAR2(45),
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_consenturi_user FOREIGN KEY (UserId) REFERENCES UTILIZATORI(IdUtilizator) ON DELETE CASCADE,
CONSTRAINT chk_tip_consent CHECK (TipConsent IN ('PROCESARE_DATE', 'MARKETING', 'COMUNICARE_BANCI')),
CONSTRAINT chk_consent_status CHECK (Status IN ('ACTIV', 'EXPIRAT', 'REVOCAT'))
);
CREATE TABLE MANDATE (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
UserId NUMBER NOT NULL,
BrokerId NUMBER NOT NULL,
Status VARCHAR2(50) DEFAULT 'ACTIV',
DataMandat TIMESTAMP DEFAULT SYSTIMESTAMP,
DataExpirare TIMESTAMP,
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_mandate_user FOREIGN KEY (UserId) REFERENCES UTILIZATORI(IdUtilizator) ON DELETE CASCADE,
CONSTRAINT fk_mandate_broker FOREIGN KEY (BrokerId) REFERENCES UTILIZATORI(IdUtilizator),
CONSTRAINT chk_mandate_status CHECK (Status IN ('ACTIV', 'EXPIRAT', 'REVOCAT')),
CONSTRAINT chk_mandate_expirare CHECK (DataExpirare IS NULL OR DataExpirare > DataMandat)
);
CREATE TABLE USER_FINANCIAL_DATA (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
UserId NUMBER NOT NULL UNIQUE,
SalariuNet NUMBER(18,2),
BonuriMasa NUMBER(1),
SumaBonuriMasa NUMBER(18,2),
VenitTotal NUMBER(18,2),
SoldTotal NUMBER(18,2),
RataTotalaLunara NUMBER(18,2),
NrCrediteBanci NUMBER,
NrIfn NUMBER,
Poprire NUMBER(1),
Intarzieri NUMBER(1),
IntarzieriNumar NUMBER,
Dti NUMBER(5,2),
ScoringLevel VARCHAR2(50),
RecommendedLevel VARCHAR2(50),
LastUpdated TIMESTAMP DEFAULT SYSTIMESTAMP,
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_financial_data_user FOREIGN KEY (UserId) REFERENCES UTILIZATORI(IdUtilizator) ON DELETE CASCADE,
CONSTRAINT chk_financial_salariu CHECK (SalariuNet IS NULL OR SalariuNet >= 0),
CONSTRAINT chk_financial_dti CHECK (Dti IS NULL OR Dti BETWEEN 0 AND 100),
CONSTRAINT chk_financial_scoring CHECK (ScoringLevel IS NULL OR ScoringLevel IN ('FOARTE_BUNA', 'BUNA', 'MEDIE', 'SLABA', 'FOARTE_SLABA')),
CONSTRAINT chk_financial_bonuri CHECK (BonuriMasa IS NULL OR BonuriMasa IN (0, 1)),
CONSTRAINT chk_financial_poprire CHECK (Poprire IS NULL OR Poprire IN (0, 1)),
CONSTRAINT chk_financial_intarzieri CHECK (Intarzieri IS NULL OR Intarzieri IN (0, 1))
);
CREATE TABLE USER_SESSIONS (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
UserId NUMBER NOT NULL,
Token VARCHAR2(500) NOT NULL UNIQUE,
ExpiresAt TIMESTAMP NOT NULL,
IpAddress VARCHAR2(45),
UserAgent VARCHAR2(500),
CreatedAt TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT fk_session_user FOREIGN KEY (UserId) REFERENCES UTILIZATORI(IdUtilizator) ON DELETE CASCADE,
CONSTRAINT chk_session_expires CHECK (ExpiresAt > CreatedAt)
);
CREATE TABLE AUDIT_LOG (
Id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
TableName VARCHAR2(100) NOT NULL,
Operation VARCHAR2(10) NOT NULL,
UserId NUMBER,
OldValues CLOB,
NewValues CLOB,
IpAddress VARCHAR2(45),
Timestamp TIMESTAMP DEFAULT SYSTIMESTAMP,
CONSTRAINT chk_audit_operation CHECK (Operation IN ('INSERT', 'UPDATE', 'DELETE'))
);
CREATE TABLE MESAJE (
cod_mesaj NUMBER PRIMARY KEY,
mesaj VARCHAR2(255) NOT NULL,
tip_mesaj VARCHAR2(1) NOT NULL,
creat_de VARCHAR2(40) NOT NULL,
creat_la DATE NOT NULL,
CONSTRAINT chk_tip_mesaj CHECK (tip_mesaj IN ('E', 'W', 'I'))
);
CREATE SEQUENCE seq_mesaje
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;
CREATE INDEX idx_applications_userid ON APLICATII(UserId);
CREATE INDEX idx_applications_status ON APLICATII(Status);
CREATE INDEX idx_applications_created ON APLICATII(CreatedAt);
CREATE INDEX idx_documents_applicationid ON DOCUMENTE(ApplicationId);
CREATE INDEX idx_consenturi_userid ON CONSENTURI(UserId);
CREATE INDEX idx_consenturi_status ON CONSENTURI(Status);
CREATE INDEX idx_mandate_userid ON MANDATE(UserId);
CREATE INDEX idx_mandate_brokerid ON MANDATE(BrokerId);
CREATE INDEX idx_mandate_status ON MANDATE(Status);
CREATE INDEX idx_audit_log_timestamp ON AUDIT_LOG(Timestamp);
CREATE INDEX idx_audit_log_tablename ON AUDIT_LOG(TableName);
CREATE INDEX idx_session_userid ON USER_SESSIONS(UserId);
CREATE INDEX idx_session_expires ON USER_SESSIONS(ExpiresAt);
CREATE INDEX idx_utilizatori_idrol ON UTILIZATORI(IdRol);
INSERT INTO ROLURI (NumeRol, Descriere) VALUES ('CLIENT', 'Utilizator standard care aplică pentru credite');
INSERT INTO ROLURI (NumeRol, Descriere) VALUES ('BROKER', 'Broker autorizat care procesează cererile de credit');
INSERT INTO ROLURI (NumeRol, Descriere) VALUES ('ADMIN', 'Administrator cu acces complet la sistem');
COMMIT;
CREATE OR REPLACE TRIGGER trg_utilizatori_varsta
BEFORE INSERT OR UPDATE OF DataNastere ON UTILIZATORI
FOR EACH ROW
BEGIN
IF :NEW.DataNastere > ADD_MONTHS(SYSDATE, -216) THEN
RAISE_APPLICATION_ERROR(-20005, 'Utilizatorul trebuie să aibă minim 18 ani');
END IF;
END;
/
CREATE OR REPLACE TRIGGER trg_utilizatori_updated
BEFORE UPDATE ON UTILIZATORI
FOR EACH ROW
BEGIN
:NEW.UpdatedAt := SYSTIMESTAMP;
END;
/
CREATE OR REPLACE TRIGGER trg_aplicatii_updated
BEFORE UPDATE ON APLICATII
FOR EACH ROW
BEGIN
:NEW.UpdatedAt := SYSTIMESTAMP;
END;
/
SELECT table_name, num_rows
FROM user_tables
WHERE table_name IN ('ROLURI', 'UTILIZATORI', 'APLICATII', 'BANCI', 'DOCUMENTE', 'CONSENTURI', 'MANDATE', 'MESAJE')
ORDER BY table_name;
BEGIN
DBMS_OUTPUT.PUT_LINE('========================================');
DBMS_OUTPUT.PUT_LINE('Tabelele au fost create cu succes!');
DBMS_OUTPUT.PUT_LINE('========================================');
END;
/

========================================
PARTEA 2: POPULAREA DATELOR
========================================

SET SERVEROUTPUT ON;
DECLARE
v_count_roluri NUMBER;
v_count_utilizatori NUMBER;
v_count_banci NUMBER;
v_count_aplicatii NUMBER;
v_count_app_banks NUMBER;
v_count_documente NUMBER;
v_count_consenturi NUMBER;
v_count_mandate NUMBER;
BEGIN
SELECT COUNT(*) INTO v_count_roluri FROM ROLURI;
SELECT COUNT(*) INTO v_count_utilizatori FROM UTILIZATORI;
SELECT COUNT(*) INTO v_count_banci FROM BANCI;
SELECT COUNT(*) INTO v_count_aplicatii FROM APLICATII;
SELECT COUNT(*) INTO v_count_app_banks FROM APPLICATION_BANKS;
SELECT COUNT(*) INTO v_count_documente FROM DOCUMENTE;
SELECT COUNT(*) INTO v_count_consenturi FROM CONSENTURI;
SELECT COUNT(*) INTO v_count_mandate FROM MANDATE;
DBMS_OUTPUT.PUT_LINE('========================================');
DBMS_OUTPUT.PUT_LINE('VERIFICARE DATE EXISTENTE');
DBMS_OUTPUT.PUT_LINE('========================================');
DBMS_OUTPUT.PUT_LINE('ROLURI: ' || v_count_roluri || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('UTILIZATORI: ' || v_count_utilizatori || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('BANCI: ' || v_count_banci || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('APLICATII: ' || v_count_aplicatii || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('APPLICATION_BANKS: ' || v_count_app_banks || ' (minim 10)');
DBMS_OUTPUT.PUT_LINE('DOCUMENTE: ' || v_count_documente || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('CONSENTURI: ' || v_count_consenturi || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('MANDATE: ' || v_count_mandate || ' (minim 5)');
DBMS_OUTPUT.PUT_LINE('========================================');
END;
/
BEGIN
INSERT INTO ROLURI (NumeRol, Descriere)
SELECT 'CLIENT', 'Utilizator standard care aplică pentru credite' FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM ROLURI WHERE NumeRol = 'CLIENT');
INSERT INTO ROLURI (NumeRol, Descriere)
SELECT 'BROKER', 'Broker autorizat care procesează cererile de credit' FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM ROLURI WHERE NumeRol = 'BROKER');
INSERT INTO ROLURI (NumeRol, Descriere)
SELECT 'ADMIN', 'Administrator cu acces complet la sistem' FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM ROLURI WHERE NumeRol = 'ADMIN');
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ ROLURI verificate/inserate');
END;
/
DECLARE
v_count NUMBER;
BEGIN
SELECT COUNT(*) INTO v_count FROM BANCI;
IF v_count < 5 THEN
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('BCR', 2.5, 1);
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('BRD', 2.8, 1);
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('BT', 2.3, 1);
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('ING', 2.6, 1);
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('UniCredit', 2.7, 1);
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('Raiffeisen', 2.4, 1);
INSERT INTO BANCI (Name, CommissionPercent, Active) VALUES
('CEC Bank', 2.2, 1);
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ BANCI inserate: ' || (7 - v_count) || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ BANCI: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count NUMBER;
v_id_client NUMBER;
v_id_broker NUMBER;
v_id_admin NUMBER;
v_parola_hash VARCHAR2(255) := 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3';
BEGIN
SELECT COUNT(*) INTO v_count FROM UTILIZATORI;
SELECT IdRol INTO v_id_client FROM ROLURI WHERE NumeRol = 'CLIENT';
SELECT IdRol INTO v_id_broker FROM ROLURI WHERE NumeRol = 'BROKER';
SELECT IdRol INTO v_id_admin FROM ROLURI WHERE NumeRol = 'ADMIN';
IF v_count < 5 THEN
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Popescu', 'Ion', 'popescu.ion', 'popescu.ion@email.com', v_parola_hash, DATE '1990-01-15', v_id_client, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Ionescu', 'Maria', 'ionescu.maria', 'ionescu.maria@email.com', v_parola_hash, DATE '1985-03-20', v_id_client, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Georgescu', 'Andrei', 'georgescu.andrei', 'georgescu.andrei@email.com', v_parola_hash, DATE '1992-07-10', v_id_client, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Dumitrescu', 'Elena', 'dumitrescu.elena', 'dumitrescu.elena@email.com', v_parola_hash, DATE '1988-11-25', v_id_client, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Marinescu', 'Constantin', 'marinescu.constantin', 'marinescu.constantin@email.com', v_parola_hash, DATE '1995-05-30', v_id_client, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Broker', 'Agent1', 'broker.agent1', 'broker.agent1@moneyshop.ro', v_parola_hash, DATE '1980-02-14', v_id_broker, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Broker', 'Agent2', 'broker.agent2', 'broker.agent2@moneyshop.ro', v_parola_hash, DATE '1982-06-18', v_id_broker, 1);
INSERT INTO UTILIZATORI (Nume, Prenume, Username, Email, Parola, DataNastere, IdRol, EmailVerified)
VALUES ('Admin', 'Sistem', 'admin.sistem', 'admin@moneyshop.ro', v_parola_hash, DATE '1975-09-12', v_id_admin, 1);
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ UTILIZATORI inserați: ' || (8 - v_count) || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ UTILIZATORI: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count NUMBER;
v_user_id NUMBER;
v_counter NUMBER := 0;
BEGIN
SELECT COUNT(*) INTO v_count FROM APLICATII;
IF v_count < 5 THEN
FOR rec_user IN (
SELECT IdUtilizator
FROM UTILIZATORI
WHERE IdRol = (SELECT IdRol FROM ROLURI WHERE NumeRol = 'CLIENT')
AND ROWNUM <= 10
) LOOP
FOR i IN 1..2 LOOP
IF v_count + v_counter >= 10 THEN
EXIT;
END IF;
INSERT INTO APLICATII (
UserId, Status, TypeCredit, TipOperatiune,
SalariuNet, Scoring, Dti, SumaAprobata, Comision,
CreatedAt, UpdatedAt
) VALUES (
rec_user.IdUtilizator,
CASE MOD(v_counter, 5)
WHEN 0 THEN 'INREGISTRAT'
WHEN 1 THEN 'IN_PROCESARE'
WHEN 2 THEN 'APROBAT'
WHEN 3 THEN 'REFUZAT'
ELSE 'ANULAT'
END,
CASE MOD(v_counter, 3)
WHEN 0 THEN 'IPOTECAR'
WHEN 1 THEN 'NEVOI_PERSONALE'
ELSE 'REFINANTARE'
END,
CASE MOD(v_counter, 2) WHEN 0 THEN 'NOU' ELSE 'REFINANTARE' END,
5000 + (v_counter * 500),
600 + (v_counter * 20),
30 + (v_counter * 5),
CASE WHEN MOD(v_counter, 5) = 2 THEN 50000 + (v_counter * 10000) ELSE NULL END,
CASE WHEN MOD(v_counter, 5) = 2 THEN (50000 + (v_counter * 10000)) * 0.025 ELSE NULL END,
SYSDATE - v_counter,
SYSDATE - v_counter + 5
);
v_counter := v_counter + 1;
END LOOP;
EXIT WHEN v_count + v_counter >= 10;
END LOOP;
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ APLICATII inserate: ' || v_counter || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ APLICATII: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count NUMBER;
v_app_id NUMBER;
v_bank_id NUMBER;
v_counter NUMBER := 0;
BEGIN
SELECT COUNT(*) INTO v_count FROM APPLICATION_BANKS;
IF v_count < 10 THEN
FOR rec_app IN (
SELECT Id FROM APLICATII WHERE ROWNUM <= 20
) LOOP
FOR rec_bank IN (
SELECT Id FROM BANCI WHERE ROWNUM <= 3
) LOOP
IF v_count + v_counter >= 20 THEN
EXIT;
END IF;
BEGIN
INSERT INTO APPLICATION_BANKS (
ApplicationId, BankId, Status, CreatedAt
) VALUES (
rec_app.Id,
rec_bank.Id,
CASE MOD(v_counter, 4)
WHEN 0 THEN 'PENDING'
WHEN 1 THEN 'APPROVED'
WHEN 2 THEN 'REJECTED'
ELSE 'CANCELLED'
END,
SYSDATE
);
v_counter := v_counter + 1;
EXCEPTION
WHEN DUP_VAL_ON_INDEX THEN
NULL;
END;
END LOOP;
EXIT WHEN v_count + v_counter >= 20;
END LOOP;
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ APPLICATION_BANKS inserate: ' || v_counter || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ APPLICATION_BANKS: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count NUMBER;
v_app_id NUMBER;
v_counter NUMBER := 0;
BEGIN
SELECT COUNT(*) INTO v_count FROM DOCUMENTE;
IF v_count < 5 THEN
FOR rec_app IN (
SELECT Id FROM APLICATII WHERE ROWNUM <= 10
) LOOP
IF v_count + v_counter >= 10 THEN
EXIT;
END IF;
INSERT INTO DOCUMENTE (
ApplicationId, TipDocument, NumeFisier, Path, SizeBytes, MimeType, CreatedAt
) VALUES (
rec_app.Id,
CASE MOD(v_counter, 4)
WHEN 0 THEN 'CI'
WHEN 1 THEN 'FLUTURAS'
WHEN 2 THEN 'EXTRAS_CONT'
ELSE 'CONTRACT'
END,
'document_' || rec_app.Id || '_' || v_counter || '.pdf',
'/documents/' || rec_app.Id || '/document_' || v_counter || '.pdf',
1024 * (100 + v_counter * 50),
'application/pdf',
SYSDATE
);
v_counter := v_counter + 1;
END LOOP;
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ DOCUMENTE inserate: ' || v_counter || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ DOCUMENTE: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count NUMBER;
v_user_id NUMBER;
v_counter NUMBER := 0;
BEGIN
SELECT COUNT(*) INTO v_count FROM CONSENTURI;
IF v_count < 5 THEN
FOR rec_user IN (
SELECT IdUtilizator
FROM UTILIZATORI
WHERE IdRol = (SELECT IdRol FROM ROLURI WHERE NumeRol = 'CLIENT')
AND ROWNUM <= 10
) LOOP
IF v_count + v_counter >= 10 THEN
EXIT;
END IF;
INSERT INTO CONSENTURI (
UserId, TipConsent, Status, DataConsent, IpAddress, CreatedAt
) VALUES (
rec_user.IdUtilizator,
CASE MOD(v_counter, 3)
WHEN 0 THEN 'PROCESARE_DATE'
WHEN 1 THEN 'MARKETING'
ELSE 'COMUNICARE_BANCI'
END,
'ACTIV',
SYSDATE,
'192.168.1.' || (100 + v_counter),
SYSDATE
);
v_counter := v_counter + 1;
END LOOP;
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ CONSENTURI inserate: ' || v_counter || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ CONSENTURI: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count NUMBER;
v_user_id NUMBER;
v_broker_id NUMBER;
v_counter NUMBER := 0;
BEGIN
SELECT COUNT(*) INTO v_count FROM MANDATE;
IF v_count < 5 THEN
FOR rec_user IN (
SELECT IdUtilizator
FROM UTILIZATORI
WHERE IdRol = (SELECT IdRol FROM ROLURI WHERE NumeRol = 'CLIENT')
AND ROWNUM <= 10
) LOOP
IF v_count + v_counter >= 10 THEN
EXIT;
END IF;
SELECT IdUtilizator INTO v_broker_id
FROM (
SELECT IdUtilizator
FROM UTILIZATORI
WHERE IdRol = (SELECT IdRol FROM ROLURI WHERE NumeRol = 'BROKER')
ORDER BY DBMS_RANDOM.VALUE
)
WHERE ROWNUM = 1;
INSERT INTO MANDATE (
UserId, BrokerId, Status, DataMandat, DataExpirare, CreatedAt
) VALUES (
rec_user.IdUtilizator,
v_broker_id,
CASE MOD(v_counter, 3)
WHEN 0 THEN 'ACTIV'
WHEN 1 THEN 'EXPIRAT'
ELSE 'REVOCAT'
END,
SYSDATE - (v_counter * 10),
SYSDATE - (v_counter * 10) + 30,
SYSDATE
);
v_counter := v_counter + 1;
END LOOP;
COMMIT;
DBMS_OUTPUT.PUT_LINE('✓ MANDATE inserate: ' || v_counter || ' noi');
ELSE
DBMS_OUTPUT.PUT_LINE('✓ MANDATE: ' || v_count || ' (suficiente)');
END IF;
END;
/
DECLARE
v_count_roluri NUMBER;
v_count_utilizatori NUMBER;
v_count_banci NUMBER;
v_count_aplicatii NUMBER;
v_count_app_banks NUMBER;
v_count_documente NUMBER;
v_count_consenturi NUMBER;
v_count_mandate NUMBER;
BEGIN
SELECT COUNT(*) INTO v_count_roluri FROM ROLURI;
SELECT COUNT(*) INTO v_count_utilizatori FROM UTILIZATORI;
SELECT COUNT(*) INTO v_count_banci FROM BANCI;
SELECT COUNT(*) INTO v_count_aplicatii FROM APLICATII;
SELECT COUNT(*) INTO v_count_app_banks FROM APPLICATION_BANKS;
SELECT COUNT(*) INTO v_count_documente FROM DOCUMENTE;
SELECT COUNT(*) INTO v_count_consenturi FROM CONSENTURI;
SELECT COUNT(*) INTO v_count_mandate FROM MANDATE;
DBMS_OUTPUT.PUT_LINE('');
DBMS_OUTPUT.PUT_LINE('========================================');
DBMS_OUTPUT.PUT_LINE('VERIFICARE FINALĂ DATE TEST');
DBMS_OUTPUT.PUT_LINE('========================================');
DBMS_OUTPUT.PUT_LINE('Entități independente (minim 5):');
DBMS_OUTPUT.PUT_LINE('  ROLURI: ' || v_count_roluri || CASE WHEN v_count_roluri >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('  UTILIZATORI: ' || v_count_utilizatori || CASE WHEN v_count_utilizatori >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('  BANCI: ' || v_count_banci || CASE WHEN v_count_banci >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('  APLICATII: ' || v_count_aplicatii || CASE WHEN v_count_aplicatii >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('  DOCUMENTE: ' || v_count_documente || CASE WHEN v_count_documente >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('  CONSENTURI: ' || v_count_consenturi || CASE WHEN v_count_consenturi >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('  MANDATE: ' || v_count_mandate || CASE WHEN v_count_mandate >= 5 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('');
DBMS_OUTPUT.PUT_LINE('Tabele asociative (minim 10):');
DBMS_OUTPUT.PUT_LINE('  APPLICATION_BANKS: ' || v_count_app_banks || CASE WHEN v_count_app_banks >= 10 THEN ' ✓' ELSE ' ✗' END);
DBMS_OUTPUT.PUT_LINE('');
DBMS_OUTPUT.PUT_LINE('========================================');
IF v_count_roluri >= 5 AND v_count_utilizatori >= 5 AND v_count_banci >= 5
AND v_count_aplicatii >= 5 AND v_count_documente >= 5
AND v_count_consenturi >= 5 AND v_count_mandate >= 5
AND v_count_app_banks >= 10 THEN
DBMS_OUTPUT.PUT_LINE('✓ TOATE CERINȚELE SUNT ÎNDEPLINITE!');
ELSE
DBMS_OUTPUT.PUT_LINE('⚠ Unele cerințe nu sunt îndeplinite!');
END IF;
DBMS_OUTPUT.PUT_LINE('========================================');
END;
/
