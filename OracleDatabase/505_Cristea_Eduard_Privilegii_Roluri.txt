================================================================================
CERINȚA 5: PRIVILEGII ȘI ROLURI
================================================================================

CERINȚĂ:
Configurarea privilegiilor și rolurilor în baza de date Oracle, incluzând:
a) Privilegii sistem și obiect
b) Ierarhii de privilegii
c) Privilegii asupra obiectelor dependente

================================================================================
COD SQL
================================================================================

-- Creare roluri Oracle
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'CREATE ROLE moneyshop_client_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
    
    BEGIN
        EXECUTE IMMEDIATE 'CREATE ROLE moneyshop_broker_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
    
    BEGIN
        EXECUTE IMMEDIATE 'CREATE ROLE moneyshop_admin_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
    
    BEGIN
        EXECUTE IMMEDIATE 'CREATE ROLE moneyshop_readonly_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/

-- Privilegii pentru CLIENT
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'GRANT SELECT ON UTILIZATORI TO moneyshop_client_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE ON APLICATII TO moneyshop_client_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT ON DOCUMENTE TO moneyshop_client_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT ON CONSENTURI TO moneyshop_client_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT ON MANDATE TO moneyshop_client_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/

-- Privilegii pentru BROKER
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'GRANT SELECT ON UTILIZATORI TO moneyshop_broker_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, UPDATE ON APLICATII TO moneyshop_broker_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE ON DOCUMENTE TO moneyshop_broker_role';
        EXECUTE IMMEDIATE 'GRANT SELECT ON CONSENTURI TO moneyshop_broker_role';
        EXECUTE IMMEDIATE 'GRANT SELECT ON MANDATE TO moneyshop_broker_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/

-- Privilegii pentru ADMIN
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON UTILIZATORI TO moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON APLICATII TO moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON DOCUMENTE TO moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON CONSENTURI TO moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON MANDATE TO moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, UPDATE, DELETE ON BANCI TO moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT ON AUDIT_LOG TO moneyshop_admin_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/

-- Ierarhie privilegii
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'GRANT moneyshop_client_role TO moneyshop_broker_role';
        EXECUTE IMMEDIATE 'GRANT moneyshop_broker_role TO moneyshop_admin_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/

-- Grant proceduri
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'GRANT EXECUTE ON sp_autentificare_utilizator TO moneyshop_client_role, moneyshop_broker_role, moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT EXECUTE ON sp_schimbare_parola TO moneyshop_client_role, moneyshop_broker_role, moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT EXECUTE ON fn_utilizator_poate_proces TO moneyshop_client_role, moneyshop_broker_role, moneyshop_admin_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/

-- Grant view-uri
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'GRANT SELECT ON vw_utilizatori_public TO moneyshop_client_role, moneyshop_broker_role, moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT ON vw_aplicatii_public TO moneyshop_client_role, moneyshop_broker_role, moneyshop_admin_role';
        EXECUTE IMMEDIATE 'GRANT SELECT ON vw_utilizatori_decrypted TO moneyshop_admin_role';
    EXCEPTION
        WHEN OTHERS THEN
            NULL;
    END;
END;
/
