# Azure OpenAI Plugin - Homework 4

## Public API URL

**Base URL:** `https://moneyshop-app.azurewebsites.net` (sau URL-ul tău Azure App Service)

**Note:** Înlocuiește `moneyshop-app` cu numele real al App Service-ului tău după deployment.

**API Endpoints:**
- `GET https://moneyshop-app.azurewebsites.net/api/openai-plugin/info`
- `POST https://moneyshop-app.azurewebsites.net/api/openai-plugin/prompt`

**Web Interface:**
- `https://moneyshop-app.azurewebsites.net/openai-plugin`

## Description of the Plugin Functionality

This plugin is a **Text Summarizer** that uses Azure OpenAI to summarize long text inputs. It accepts a text prompt through a REST API endpoint and returns a concise summary generated by Azure OpenAI's language model.

**Key Features:**
- Accepts text input through HTTP POST request
- Uses Azure OpenAI (gpt-4o-mini model) to generate summaries
- Returns structured JSON response with the summary
- Includes comprehensive error handling for various failure scenarios
- Provides a user-friendly web interface for testing

## Example Request and Response

### 1. GET /api/openai-plugin/info

**Request:**
```http
GET /api/openai-plugin/info
```

**Response (200 OK):**
```json
{
  "name": "MoneyShop Text Summarizer Plugin",
  "description": "Summarizes the text received through the prompt using Azure OpenAI",
  "version": "1.0.0"
}
```

### 2. POST /api/openai-plugin/prompt

**Request:**
```http
POST /api/openai-plugin/prompt
Content-Type: application/json

{
  "prompt": "Azure OpenAI este un serviciu cloud care oferă acces la modele de inteligență artificială dezvoltate de OpenAI. Acesta permite dezvoltatorilor să integreze capabilități de AI în aplicațiile lor folosind infrastructura Azure. Serviciul oferă modele precum GPT-4, GPT-3.5, și DALL-E pentru generare de text și imagini."
}
```

**Response (200 OK):**
```json
{
  "result": "Azure OpenAI este un serviciu cloud care permite dezvoltatorilor să integreze modele AI (precum GPT-4, GPT-3.5, DALL-E) în aplicațiile lor folosind infrastructura Azure pentru generare de text și imagini.",
  "model": "gpt-4o-mini",
  "success": true
}
```

## Azure OpenAI Model and Deployment Used

- **Model:** `gpt-4o-mini`
- **Deployment Name:** `gpt-4o-mini`
- **API Version:** `2024-02-15-preview`
- **Endpoint:** `https://openaimoneyshop.openai.azure.com`

**Why gpt-4o-mini?**
- Most cost-effective model available (~$0.15/$0.60 per 1M tokens)
- Excellent performance for text summarization tasks
- Fast response times
- Suitable for production workloads

## How to Trigger an Error

### Error 1: Invalid or Empty Prompt (400 Bad Request)

**Request:**
```http
POST /api/openai-plugin/prompt
Content-Type: application/json

{
  "prompt": ""
}
```

**Response:**
```json
{
  "error": "Invalid request",
  "message": "Prompt cannot be empty or null. Please provide a valid prompt in the request body."
}
```

**Or:**
```http
POST /api/openai-plugin/prompt
Content-Type: application/json

{}
```

### Error 2: Azure OpenAI Configuration Error (500 Internal Server Error)

**How to trigger:**
- Remove or invalidate `AzureOpenAI:Endpoint` or `AzureOpenAI:ApiKey` in Azure App Settings
- Restart the application

**Response:**
```json
{
  "error": "Configuration error",
  "message": "Azure OpenAI is not configured. Please set AzureOpenAI:Endpoint and AzureOpenAI:ApiKey in appsettings.json"
}
```

### Error 3: Azure OpenAI Request Failure (502 Bad Gateway)

**How to trigger:**
- Use an invalid API key in Azure App Settings
- Use an invalid endpoint URL
- Use a non-existent deployment name

**Response:**
```json
{
  "error": "Azure OpenAI request failed",
  "message": "Failed to communicate with Azure OpenAI service. Please check the configuration and try again."
}
```

### Error 4: Internal Server Error (500 Internal Server Error)

**How to trigger:**
- Cause an unexpected exception in the service (e.g., network timeout, malformed response)

**Response:**
```json
{
  "error": "Internal server error",
  "message": "An unexpected error occurred while processing your request."
}
```

## How and Where the App is Deployed

### Deployment Location

The application is deployed to **Azure App Service** (Platform-as-a-Service).

**Deployment Details:**
- **Service Type:** Azure App Service (Windows/Linux)
- **Runtime:** .NET 6.0
- **Deployment Method:** ZIP deployment via Azure CLI
- **Configuration:** Azure App Settings for environment variables and secrets

### Deployment Process

1. **Build the application:**
   ```bash
   dotnet publish -c Release -o ./publish
   ```

2. **Create deployment package:**
   ```bash
   zip -r publish.zip ./publish/*
   ```

3. **Deploy using Azure CLI:**
   ```bash
   az webapp deployment source config-zip \
     --resource-group MoneyShop \
     --name moneyshop-app \
     --src publish.zip
   ```

4. **Configure Azure App Settings:**
   - Azure Portal → App Service → Configuration → Application settings
   - Add settings with `__` (double underscore) for nested configuration:
     - `AzureOpenAI__Endpoint`
     - `AzureOpenAI__ApiKey`
     - `AzureOpenAI__DeploymentName`
     - `AzureOpenAI__ApiVersion`

5. **Restart the application:**
   - Azure Portal → App Service → Overview → Restart

### Architecture

```
┌─────────────────┐
│  Azure App      │
│  Service        │
│  (Hosted)       │
└────────┬────────┘
         │
         │ HTTP Requests
         │
┌────────▼────────────────────────┐
│  ASP.NET Core Web API          │
│  - OpenAIPluginController       │
│  - AzureOpenAIPluginService     │
└────────┬────────────────────────┘
         │
         │ REST API Calls
         │
┌────────▼────────────────────────┐
│  Azure OpenAI                  │
│  - Endpoint: *.openai.azure.com│
│  - Model: gpt-4o-mini          │
└────────────────────────────────┘
```

### Configuration Management

**Local Development:**
- Uses User Secrets (stored locally, not in Git)
- Configuration in `appsettings.Development.json` (without secrets)

**Production (Azure App Service):**
- Uses Azure App Settings (configured in Azure Portal)
- Secrets stored securely in Azure App Settings
- No secrets in source code or Git repository

### Deployment Script

See `deploy.sh` for complete deployment automation including:
- Resource creation (if needed)
- Application build
- ZIP package creation
- Deployment to Azure App Service
- Configuration of Azure App Settings

**Important:** After deployment, you must configure Azure App Settings in Azure Portal. See `AZURE_CONFIGURATION_GUIDE.md` for detailed step-by-step instructions.

## Testing

### Using Web Interface

1. Navigate to: `https://moneyshop-app.azurewebsites.net/openai-plugin`
2. Click "Get Plugin Info" to verify plugin information
3. Enter text in the textarea
4. Click "Process Prompt" to get summary

### Using API Directly

**cURL Example:**
```bash
# Get plugin info
curl https://moneyshop-app.azurewebsites.net/api/openai-plugin/info

# Process prompt
curl -X POST https://moneyshop-app.azurewebsites.net/api/openai-plugin/prompt \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Your long text here..."}'
```

**PowerShell Example:**
```powershell
# Get plugin info
Invoke-RestMethod -Uri "https://moneyshop-app.azurewebsites.net/api/openai-plugin/info" -Method Get

# Process prompt
$body = @{ prompt = "Your long text here..." } | ConvertTo-Json
Invoke-RestMethod -Uri "https://moneyshop-app.azurewebsites.net/api/openai-plugin/prompt" -Method Post -Body $body -ContentType "application/json"
```

## Source Code Structure

```
HW4/
├── README.md                          # This file
├── deploy.sh                          # Deployment script
├── BusinessLogic/
│   └── Implementation/
│       └── OpenAIPlugin/
│           └── AzureOpenAIPluginService.cs
├── MoneyShop/
│   ├── Controllers/
│   │   ├── Api/
│   │   │   └── OpenAIPluginController.cs
│   │   └── OpenAIPluginWebController.cs
│   └── Views/
│       └── OpenAIPluginWeb/
│           └── Index.cshtml
└── MoneyShop.csproj                   # Project file with UserSecretsId
```

## Security Notes

- API keys are stored in Azure App Settings (not in source code)
- User Secrets used for local development (not committed to Git)
- HTTPS enforced for all API endpoints
- Error messages don't expose sensitive information

## Cost Considerations

- **gpt-4o-mini:** ~$0.15 per 1M input tokens, ~$0.60 per 1M output tokens
- Average request: ~100-200 tokens input, ~50-100 tokens output
- Estimated cost per request: ~$0.0001 - $0.0002

---

**Author:** [Your Name]  
**Date:** 2026-01-19  
**Course:** Cloud Computing - Homework 4

